

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel de Controle Financeiro</title>
        <link rel="icon" href="https://facbolotas.github.io/painel/controle/bolotas.ico" type="image/x-icon">
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: Arial, sans-serif; background: #1b1b1b; color: #1a1a1a; line-height: 1.6; }
        /* HEADER & LOGOUT */
        header { position: fixed; top: 10px; right: 20px; z-index: 999; }
        .btn-sair { background: linear-gradient(to right, #2753e5, #122ab3); color: white; padding: 8px 16px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: transform 0.2s; font-size: 13px;}
        .btn-sair:hover { transform: scale(1.05); }
        .container { max-width: 1200px; margin: 1rem auto; padding: 0 0.5rem; }                
        /* SALDO CARD */
        .saldo-card { background: linear-gradient(90deg, #ff0000, #ffffff, #f50000); color: #272727; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; text-align: center; }
        .saldo-card div:first-child { font-size: 0.8rem; }
        .saldo-card #saldo { font-size: 1.5rem; font-weight: bold; }
        /* MAIN LAYOUT */
        .main { display: grid; grid-template-columns: 1.5fr 2fr; gap: 1rem; margin-bottom: 1rem; }
        .card { background: #fff; border-radius: 12px; padding: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .card h2 { margin-bottom: 0.5rem; font-size: 1rem; text-align: center; }
        /* EXTRATO */
        .extrato-container { display: flex; flex-direction: column; height: auto; }
        .extrato-lista { overflow-y: auto; margin-top: 0.5rem; flex-grow: 1; }
        .extrato-item { border-bottom: 1px solid #d6d6d6; padding: 0.2rem 0; font-size: 0.6rem; display: grid; grid-template-columns: 0.8fr 1fr 1.2fr 0.6fr 0.8fr 1fr 0.8fr; gap: 0.1rem; text-align: center; justify-items: center; }
        .extrato-item:last-child { border: none; }
        .valor-negativo { color: #ef4444; }
        .valor-positivo { color: #10b981; }
        .extrato-header { font-weight: bold; border-bottom: 2px solid #ccc; padding-bottom: 2px; font-size: 0.7rem; }
        .extrato-btn-group { margin-top: 0.5rem; display: flex; justify-content: flex-end; }
        .extrato-btn-group button { margin-left: 0.3rem; padding: 0.3rem; font-size: 0.7rem; }
        .btn-secondary { background: #3b48f6; color: #fff; margin-left: 0.5rem; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.75rem; }
        /* CUSTOM STYLES FOR CALCULATOR INTEGRATION */
        .calculator-container {
            background-color: #333;
            padding: 15px;
            border-radius: 12px;
            box-shadow: none;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .display-container {
            background-color: #222;
            border-radius: 10px;
            padding: 10px;
            border: 3px solid #111;
            overflow: hidden; /* Garante que o conte√∫do n√£o vaze */
        }
        .display {
            background-color: #a3c9a3;
            color: #111;
            font-size: 1em;
            padding: 8px;
            border-radius: 5px;
            min-height: 2.5em; /* Aumentado para evitar corte */
            text-align: right;
            overflow-x: auto; /* Rolagem horizontal se necess√°rio */
            white-space: nowrap;
            font-weight: bold;
            border: none;
            width: 100%; /* Garante que ocupe toda a largura dispon√≠vel */
            box-sizing: border-box; /* Inclui padding na largura total */
        }
        #calculation-summary {
            margin-top: 10px;
            font-size: 0.7em;
            color: #111;
            min-height: 2em; /* Aumentado para evitar corte */
            text-align: left;
            white-space: normal;
            background-color: #a3c9a3;
            height: auto;
            padding: 8px;
            border-radius: 5px;
            font-weight: normal;
            white-space: pre-wrap;
            overflow-y: auto; /* Rolagem vertical se necess√°rio */
            max-height: 100px; /* Limita a altura m√°xima */
        }
        #total-display {
            font-size: 1.4em;
            margin-top: 5px;
            background-color: #c0ffc0;
            width: 100%; /* Garante que ocupe toda a largura */
        }
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 0 5px;
        }
        .partnership-control {
            display: flex;
            align-items: center;
            color: white;
            gap: 5px;
            font-size: 0.9em;
        }
        #reset-button {
            background-color: #cc0000;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9em;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px #990000;
            position: relative;
        }
        #reset-button:hover {
            background-color: #ff3333;
        }
        #reset-button:active {
            background-color: #990000;
            transform: translateY(4px);
            box-shadow: 0 0 #990000;
        }
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 5px;
        }
        .item-button {
            background-color: #666;
            color: white;
            border: none;
            padding: 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.1s, transform 0.05s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.6em;
            text-align: center;
            position: relative;
            min-height: 60px;
        }
        .item-button:hover {
            background-color: #777;
        }
        .item-button:active {
            transform: scale(0.98);
        }
        .item-button[data-count]:not([data-count="0"]) {
            background-color: #555;
        }
        .item-icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        .item-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #cc0000;
            color: white;
            border-radius: 50%;
            padding: 2px 5px;
            font-size: 12px;
            font-weight: bold;
            min-width: 15px;
            text-align: center;
            display: none;
        }
        .item-button[data-count]:not([data-count="0"]) .item-count {
            display: block;
        }
        @media (max-width: 400px) {
            .calculator-container { padding: 10px; }
            .buttons-grid { grid-template-columns: repeat(3, 1fr); }
            .item-button { font-size: 0.6em; min-height: 60px; }
            .item-icon { font-size: 1.2em; }
            .display { font-size: 0.9em; min-height: 2em; }
            #total-display { font-size: 1.2em; }
            #calculation-summary { font-size: 0.7em; min-height: 1.5em; max-height: 80px; }
        }
        /* FORM FIELDS OUTSIDE CALCULATOR */
        .form-group { margin-bottom: 0.5rem; }
        .form-group label { display: block; margin-bottom: 0.25rem; font-size: 0.7rem; font-weight: bold; }
        .form-group input { width: 100%; padding: 0.3rem; border: 1px solid #ccc; border-radius: 8px; font-size: 0.8rem; }
        .btn-primary { background: #353535; color: #fff; padding: 0.4rem; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.75rem; width: 100%; }
        /* Responsividade */
        @media (max-width: 768px) {
            .main { grid-template-columns: 1fr; }
            .extrato-container { height: auto; }
            .extrato-item { font-size: 0.55rem; grid-template-columns: 1fr 1fr 1fr 0.5fr 0.8fr 0.8fr 0.8fr; }
        }
        /* FOOTER STYLES */
        footer {
            text-align: center;
            padding: 1rem 0;
            color: #ccc; /* Cor do texto para contraste */
            font-size: 0.7rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <button class="btn-sair" onclick="logout()">‚Ü© Sair</button>
    </header>

    <div class="container">
        <div style="text-align: center; margin-top: 1rem;">
        <img src="https://i.ibb.co/Ps0zPY0g/bolotas.gif" width="140" height="110" alt="Descri√ß√£o da imagem" style="border-radius: 12px;">
        </div>
        <div id="usuario-logado" style="text-align: center; margin-bottom: 1rem; font-weight: bold; color: #ffffff;">Usu√°rio: Carregando...</div>

        <div class="saldo-card">
            <div>SALDO TOTAL</div>
            <div id="saldo">R$ 0</div>
        </div>

        <div class="main">
            <div class="card">
                <div class="calculator-container">
                    <div class="display-container">
                        <input type="text" class="display" id="total-display" readonly value="0">
                    </div>
                    <div class="controls">
                        <div class="partnership-control">
                            <input type="checkbox" id="partnership-checkbox">
                            <label for="partnership-checkbox">Com Parceria?</label>
                        </div>
                        <button id="reset-button">Resetar</button>
                    </div>
                    <div class="buttons-grid" id="item-buttons-container"></div>
                    <div class="display-container">
                        <div id="calculation-summary">Nenhum item selecionado.</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Fac√ß√£o/Descri√ß√£o:</label>
                    <input type="text" id="descricao" placeholder="Nome da fac√ß√£o/Descri√ß√£o">
                </div>
                <button class="btn-primary" onclick="confirmarMovimentacao()">‚úÖ Adicionar Transa√ß√£o</button>
            </div>

            <div class="card">
                <h2>Extrato Recente</h2>
                <div class="extrato-container">
                    <div class="extrato-item extrato-header">
                        <div>Tipo</div><div>Item</div><div>Descri√ß√£o</div><div>Qtd.</div><div>Usu√°rio</div><div>Data</div><div>Valor</div>
                    </div>
                    <div class="extrato-lista" id="extrato-lista"></div>
                </div>
                <div class="extrato-btn-group">
                    <button class="btn-secondary" onclick="limparHistorico()">üóë Limpar Extrato</button>
                    <button class="btn-secondary" onclick="location.href='relatorio.html'">üìÑ Relat√≥rio</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        Desenvolvido by GomesCN
    </footer>

    <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD-EfRfiAbc3I7cxDOP3g3bdRivoVz3qBE",
      authDomain: "bolotas-7ef79.firebaseapp.com",
      databaseURL: "https://bolotas-7ef79-default-rtdb.firebaseio.com/",
      projectId: "bolotas-7ef79"
    };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let saldo = 0, extrato = [];
        let usuarioLogado = null;

        let contagemItens = {};
        const precosItens = {
            "Algema": { parceria: 4000, semParceria: 5000 }, "Capuz": { parceria: 3000, semParceria: 4000 },
            "C4": { parceria: 3000, semParceria: 3500 }, "Colete": { parceria: 6000, semParceria: 7000 },
            "√Ålcool": { parceria: 1000, semParceria: 1300 }, "Caixa de Attachs": { parceria: 9000, semParceria: 12000 },
            "Cart√£o Comum": { parceria: 25000, semParceria: 30000 }, "Cart√£o Incomum": { parceria: 30000, semParceria: 35000 },
            "Cart√£o √âpico": { parceria: 55000, semParceria: 60000 }, "Cart√£o Raro": { parceria: 40000, semParceria: 45000 },
            "Cart√£o Lend√°rio": { parceria: 70000, semParceria: 75000 }, "Caixa Colete": { parceria: 60000, semParceria: 70000 },
            "Caixa de C4": { parceria: 30000, semParceria: 35000 }, "Caixa de Algema": { parceria: 40000, semParceria: 50000 },
            "Caixa Alcool": { parceria: 10000, semParceria: 13000 }, "Pendrive Comum": { parceria: 25000, semParceria: 30000 },
            "Pendrive Raro": { parceria: 35000, semParceria: 40000 }, "Pendrive √âpico": { parceria: 55000, semParceria: 60000 }
        };
        const iconMap = {
            "Algema": { icon: "‚õìÔ∏è", label: "Algema" }, "Capuz": { icon: "üßë", label: "Capuz" },
            "C4": { icon: "üí£", label: "C4" }, "Colete": { icon: "üõ°Ô∏è", label: "Colete" },
            "√Ålcool": { icon: "üß™", label: "√Ålcool" }, "Caixa de Attachs": { icon: "üì¶", label: "Caixa Attachs" },
            "Cart√£o Comum": { icon: "üí≥", label: "C. Comum" }, "Cart√£o Incomum": { icon: "üí≥", label: "C. Incomum" },
            "Cart√£o √âpico": { icon: "üí≥", label: "C. √âpico" }, "Cart√£o Raro": { icon: "üí≥", label: "C. Raro" },
            "Cart√£o Lend√°rio": { icon: "üí≥", label: "C. Lend√°rio" }, "Caixa Colete": { icon: "üõ°Ô∏èüì¶", label: "Caixa Colete" },
            "Caixa de C4": { icon: "üí£üì¶", label: "Caixa C4" }, "Caixa de Algema": { icon: "‚õìÔ∏èüì¶", label: "Caixa Algema" },
            "Caixa Alcool": { icon: "üß™üì¶", label: "Caixa √Ålcool" }, "Pendrive Comum": { icon: "üíæ", label: "P. Comum" },
            "Pendrive Raro": { icon: "üíæ", label: "P. Raro" }, "Pendrive √âpico": { icon: "üíæ", label: "P. √âpico" },
            "Dep√≥sito": { icon: "üí∞", label: "Dep√≥sito" }, "Saque": { icon: "üí∏", label: "Saque" }
        };

        function formatNumber(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function isManualMode() {
            return ['Dep√≥sito', 'Saque'].some(item => contagemItens[item] > 0);
        }

        function updateCalculation() {
            if (isManualMode()) {
                return; // Manter o estado manual
            }

            let total = 0;
            let summaryHtml = "";
            const isParceria = document.getElementById('partnership-checkbox').checked;
            const precoKey = isParceria ? 'parceria' : 'semParceria';
            
            const itensSelecionados = Object.keys(contagemItens).filter(item => contagemItens[item] > 0 && precosItens[item]);

            const totalInput = document.getElementById('total-display');
            const calculationSummary = document.getElementById('calculation-summary');

            if (itensSelecionados.length === 0) {
                totalInput.value = formatNumber(0);
                calculationSummary.innerHTML = "Nenhum item selecionado.";
                return;
            }

            itensSelecionados.forEach(item => {
                const count = contagemItens[item];
                const precoUnitario = precosItens[item][precoKey];
                const subTotal = count * precoUnitario;
                total += subTotal;

                const label = iconMap[item].label;
                summaryHtml += `${count}x ${label} (${formatNumber(precoUnitario)} cada) = ${formatNumber(subTotal)}<br>`;
            });
            
            totalInput.value = formatNumber(total);
            calculationSummary.innerHTML = summaryHtml;
        }

        function handleManualTransaction(item) {
            const isCurrentlySelected = contagemItens[item] > 0;
            resetCalculation(true); // Limpa tudo, incluindo visual

            if (isCurrentlySelected) {
                return;
            }

            contagemItens[item] = 1;

            const button = document.querySelector(`.item-button[data-item="${item}"]`);
            if (button) {
                button.setAttribute('data-count', 1);
                button.querySelector('.item-count').textContent = 1;
            }

            const checkbox = document.getElementById('partnership-checkbox');
            checkbox.disabled = true;
            checkbox.checked = false;
            document.querySelector('label[for="partnership-checkbox"]').textContent = `Transa√ß√£o: ${item}`;

            const totalInput = document.getElementById('total-display');
            totalInput.removeAttribute('readonly');
            totalInput.value = '';
            totalInput.placeholder = 'Digite o valor';

            document.getElementById('calculation-summary').innerHTML = `Transa√ß√£o <b>${item}</b> selecionada. Digite o valor manualmente.`;
        }

        function createItemButtons() {
            const container = document.getElementById('item-buttons-container');
            Object.keys(iconMap).forEach(item => {
                contagemItens[item] = 0;
                const button = document.createElement('button');
                button.className = 'item-button';
                button.setAttribute('data-item', item);
                button.setAttribute('data-count', 0);
                const { icon, label } = iconMap[item];
                button.innerHTML = `
                    <span class="item-icon">${icon}</span>
                    <span class="item-label">${label}</span>
                    <span class="item-count">0</span>
                `;
                button.addEventListener('click', function() {
                    if (['Dep√≥sito', 'Saque'].includes(item)) {
                        handleManualTransaction(item);
                    } else {
                        if (isManualMode()) {
                            resetCalculation();
                        }
                        contagemItens[item]++;
                        const newCount = contagemItens[item];
                        button.setAttribute('data-count', newCount);
                        button.querySelector('.item-count').textContent = newCount;
                        updateCalculation();
                    }
                });
                container.appendChild(button);
            });
        }

        function resetCalculation() {
            Object.keys(contagemItens).forEach(item => {
                contagemItens[item] = 0;
                const button = document.querySelector(`.item-button[data-item="${item}"]`);
                if (button) {
                    button.setAttribute('data-count', 0);
                    button.querySelector('.item-count').textContent = 0;
                }
            });

            const checkbox = document.getElementById('partnership-checkbox');
            checkbox.disabled = false;
            checkbox.checked = false;
            document.querySelector('label[for="partnership-checkbox"]').textContent = 'Com Parceria?';

            const totalInput = document.getElementById('total-display');
            totalInput.setAttribute('readonly', '');
            totalInput.placeholder = '';
            totalInput.value = '0';

            updateCalculation();
        }

        document.addEventListener('DOMContentLoaded', () => {
            createItemButtons();
            document.getElementById('partnership-checkbox').addEventListener('change', updateCalculation);
            document.getElementById('reset-button').addEventListener('click', resetCalculation);
            updateCalculation();
        });

        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                usuarioLogado = user;
                const nomeUsuario = user.displayName ? user.displayName : user.email.split('@')[0];
                document.getElementById('usuario-logado').innerText = 'Usu√°rio: ' + nomeUsuario;
                db.ref('controleCaixa').once('value', snap => {
                    const v = snap.val() || { saldo: 0, extrato: [] };
                    saldo = v.saldo;
                    extrato = Array.isArray(v.extrato) ? v.extrato : [];
                    atualizarSaldo();
                    atualizarExtrato();
                });
            } else {
                location.href = 'index.html';
            }
        });

        function formatar(n) {
            if (n === 0) return 'R$ 0,00';
            const absN = Math.abs(n);
            return absN.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function atualizarSaldo() {
            document.getElementById('saldo').innerText = formatar(saldo);
        }

        function atualizarExtrato() {
            const box = document.getElementById('extrato-lista');
            box.innerHTML = '';
            extrato.slice(0, 20).forEach(m => {
                const div = document.createElement('div');
                div.className = 'extrato-item';
                const valorExibicao = formatar(m.valor);
                const valorClass = (m.tipo === 'Saque') ? 'valor-negativo' : 'valor-positivo';
                const tipoExtrato = (m.tipo === 'parceria' || m.tipo === 'semParceria') ? 'VENDA' : m.tipo.toUpperCase();
                div.innerHTML = `
                    <div>${tipoExtrato}</div>
                    <div>${m.item || '-'}</div>
                    <div>${m.descricao}</div>
                    <div>${m.quantidade || '-'}</div>
                    <div>${m.autor}</div>
                    <div>${m.data.split(',')[0]}</div>
                    <div class="${valorClass}">
                        ${(m.tipo === 'Saque') ? '-' : ''}${valorExibicao}
                    </div>
                `;
                box.appendChild(div);
            });
        }

        async function confirmarMovimentacao() {
            const descricao = document.getElementById('descricao').value;
            if (!usuarioLogado) return alert('Usu√°rio n√£o autenticado.');
            if (!descricao.trim()) return alert("Descri√ß√£o/Fac√ß√£o √© obrigat√≥ria.");
            const itensSelecionados = Object.keys(contagemItens).filter(item => contagemItens[item] > 0);
            if (itensSelecionados.length === 0) return alert("Selecione pelo menos um item para a transa√ß√£o.");

            const autor = usuarioLogado.displayName || usuarioLogado.email.split('@')[0];
            const dataTransacao = new Date().toLocaleString('pt-BR');
            const transacoesParaAdicionar = [];
            let novoSaldo = saldo;

            if (isManualMode()) {
                const item = itensSelecionados[0];
                const totalInput = document.getElementById('total-display');
                const valorStr = totalInput.value.trim();
                const valor = parseFloat(valorStr.replace(/\./g, '').replace(',', '.'));
                if (isNaN(valor) || valor <= 0) return alert(`Valor de ${item} inv√°lido ou n√£o preenchido.`);

                const valorAbsoluto = valor;
                novoSaldo += (item === 'Saque' ? -valorAbsoluto : valorAbsoluto);

                transacoesParaAdicionar.push({
                    tipo: item, item: item, quantidade: 1, descricao, autor, valor: valorAbsoluto,
                    tipoVenda: item, data: dataTransacao
                });
            } else {
                const isParceria = document.getElementById('partnership-checkbox').checked;
                const tipoVenda = isParceria ? 'parceria' : 'semParceria';

                let total = 0;
                itensSelecionados.forEach(item => {
                    const qtd = contagemItens[item];
                    const precoUnitario = precosItens[item][tipoVenda];
                    if (precoUnitario) {
                        total += precoUnitario * qtd;
                    }
                });

                let transactionItem = 'Venda';
                let quantidade = '-';
                if (itensSelecionados.length === 1) {
                    transactionItem = itensSelecionados[0];
                    quantidade = contagemItens[transactionItem];
                } else {
                    transactionItem = 'M√∫ltiplos Itens';
                    quantidade = itensSelecionados.reduce((sum, item) => sum + contagemItens[item], 0);
                }

                novoSaldo += total;

                transacoesParaAdicionar.push({
                    tipo: tipoVenda, item: transactionItem, quantidade, descricao, autor, valor: total,
                    tipoVenda, data: dataTransacao
                });
            }

            extrato.unshift(...transacoesParaAdicionar);
            saldo = novoSaldo;

            await db.ref('controleCaixa').set({ saldo, extrato });

            atualizarSaldo();
            atualizarExtrato();
            resetCalculation();
            document.getElementById('descricao').value = '';
        }

        function logout() {
            firebase.auth().signOut().then(() => location.href = 'index.html');
        }

        function limparHistorico() {
            if (extrato.length === 0) return alert('Nenhum extrato dispon√≠vel.');

            const agora = new Date();
            const inicioPeriodoUm = new Date(2025, 5, 1);
            const inicioMesPassado = new Date(agora.getFullYear(), agora.getMonth() - 1, 1);
            const fimMesPassado = new Date(agora.getFullYear(), agora.getMonth(), 0);

            let periodo = prompt(
                `De qual per√≠odo voc√™ deseja visualizar as transa√ß√µes para excluir?\n\n` +
                `1 - De 01/06/2025 at√© ${agora.toLocaleDateString('pt-BR')}\n` +
                `2 - M√™s Passado (${inicioMesPassado.toLocaleDateString('pt-BR')} at√© ${fimMesPassado.toLocaleDateString('pt-BR')})`
            );

            let extratoFiltrado = [];

            function parseDataFlexivel(dataString) {
                if (!dataString) return null;
                let data;
                const partes = dataString.split(',')[0].split('/');
                if (partes.length === 3 && partes[2].length === 4) {
                    data = new Date(`${partes[2]}-${partes[1]}-${partes[0]}`);
                } else if (!isNaN(Date.parse(dataString))) {
                    data = new Date(dataString);
                } else {
                    return null;
                }
                return isNaN(data.getTime()) ? null : data;
            }

            if (periodo === '1') {
                extratoFiltrado = extrato.filter(e => {
                    let dataTransacao = parseDataFlexivel(e.data);
                    return dataTransacao && dataTransacao >= inicioPeriodoUm && dataTransacao <= agora;
                });
            } else if (periodo === '2') {
                extratoFiltrado = extrato.filter(e => {
                    let dataTransacao = parseDataFlexivel(e.data);
                    return dataTransacao && dataTransacao >= inicioMesPassado && dataTransacao <= fimMesPassado;
                });
            } else {
                return alert('Per√≠odo inv√°lido ou cancelado.');
            }

            if (extratoFiltrado.length === 0) {
                return alert('Nenhuma transa√ß√£o encontrada nesse per√≠odo.');
            }

            let lista = extratoFiltrado.map((item, idx) => {
                return `${idx + 1} ‚Äì ${item.tipo} ‚Äì ${item.descricao} ‚Äì ${formatar(item.valor)} ‚Äì ${item.autor} ‚Äì ${item.data}`;
            }).join('\n');

            let escolha = prompt(`Escolha o n√∫mero da transa√ß√£o que deseja excluir:\n\n${lista}`);
            let indexEscolhido = parseInt(escolha) - 1;

            if (isNaN(indexEscolhido) || indexEscolhido < 0 || indexEscolhido >= extratoFiltrado.length) {
                return alert('N√∫mero inv√°lido.');
            }

            let itemSelecionado = extratoFiltrado[indexEscolhido];

            let senha = prompt('Digite a senha:');
            if (senha !== 'bolotas23k') return alert('Senha incorreta.');

            let indexReal = extrato.findIndex(e =>
                e.tipo === itemSelecionado.tipo &&
                e.descricao === itemSelecionado.descricao &&
                e.autor === itemSelecionado.autor &&
                e.data === itemSelecionado.data &&
                e.valor === itemSelecionado.valor
            );

            if (indexReal !== -1) {
                let valorParaAjustar = itemSelecionado.valor;
                if (itemSelecionado.tipo === 'Saque') {
                    saldo += valorParaAjustar;
                } else {
                    saldo -= valorParaAjustar;
                }
                extrato.splice(indexReal, 1);
                db.ref('controleCaixa').set({ saldo, extrato });
                atualizarSaldo();
                atualizarExtrato();
                alert('Transa√ß√£o exclu√≠da com sucesso.');
            } else {
                alert('N√£o foi poss√≠vel localizar a transa√ß√£o.');
            }
        }
    </script>
</body>
</html>


